var app=angular.module("app",["ngRoute","ngAnimate","ngTouch","ui.calendar"]);app.config(["$routeProvider",function($routeProvider){$routeProvider.when("/",{templateUrl:"app/views/home.html"}).when("/getting-started",{templateUrl:"app/views/getting-started.html",title:"Getting Started"}).when("/timedate/timedifference",{templateUrl:"app/views/timedate/timedifference.html",controller:"TimeDifferenceController",title:"Time Difference"}).when("/timedate/datedifference",{templateUrl:"app/views/timedate/datedifference.html",controller:"DateDifferenceController",title:"Date Difference"}).when("/timedate/timezone",{templateUrl:"app/views/timedate/timezone.html",controller:"TimezoneController",title:"Timezone Finder"}).when("/timedate/calendar",{templateUrl:"app/views/timedate/calendar.html",controller:"CalendarController",title:"Calendar"}).when("/timedate/stopwatch",{templateUrl:"app/views/timedate/stopwatch.html",controller:"StopwatchController",title:"Stopwatch"}).when("/unitconversion",{templateUrl:"app/views/unit-conversion.html",controller:"UnitConversionController",title:"Unit Conversion"}).when("/calculator",{templateUrl:"app/views/calculator.html",title:"Calculator"}).when("/language/dictionary",{templateUrl:"app/views/language/dictionary.html",controller:"DictionaryController",title:"Dictionary"}).when("/language/grammar",{templateUrl:"app/views/language/grammar.html",controller:"GrammarController",title:"Grammar Reference"}).when("/astronomy/telescopecalculator",{templateUrl:"app/views/astronomy/telescope-calculator.html",controller:"TelescopeCalculatorController",title:"Telescope Calculator"}).when("/document/notes",{templateUrl:"app/views/document/notes.html",controller:"NotesController",title:"Notes"}),$routeProvider.when("/404",{templateUrl:"app/views/error/404.html"}),$routeProvider.otherwise("/404")}]),app.controller("AppController",["$scope","$timeout","menu","$location","$route","$rootScope","$log","$window","$animate","$anchorScroll",function($scope,$timeout,menu,$location,$route,$rootScope,$log,$window,$animate,$anchorScroll){function saveLocalData(){localStorage.settings=JSON.stringify($scope.localData.settings)}$scope.SITE_ROOT="theservergod.github.io"===window.location.hostname?"http://theservergod.github.io/Utilitron/":"/",$scope.$route=$route,$scope.menu=menu,$scope.localData={settings:{},data:{}};var defaultSettings={welcomeHero:!0};$scope.localData.settings=localStorage.length&&localStorage.settings?JSON.parse(localStorage.settings):defaultSettings,$scope.localData.data=localStorage.length&&localStorage.data?JSON.parse(localStorage.data):{},$rootScope.$on("saveData",saveLocalData),$scope.clearLocalStorage=function(){confirm("This will delete ALL your locally saved data and settings.\n\nAre you sure?")&&(localStorage.clear(),Materialize.toast("Local storage cleared. Page will reload in 4 seconds",4e3),$timeout(function(){window.location.reload()},4e3))},$scope.toggleWelcomeHero=function(){$scope.localData.settings.welcomeHero=$scope.localData.settings.welcomeHero?!$scope.localData.settings.welcomeHero:!0,$rootScope.$emit("saveData")},$scope.openModal=function(modalSelector){$(modalSelector).openModal()},$scope.closeModal=function(modalSelector){$(modalSelector).closeModal()},$scope.gotoAnchor=function(x){var newHash="anchor-"+x;$location.hash()!==newHash?$location.hash("anchor-"+x):$anchorScroll()}}]),app.controller("CalendarController",["$scope",function($scope){$scope.uiConfig={calendar:{editable:!0,header:{left:"month basicWeek basicDay agendaWeek agendaDay",center:"title",right:"today prev,next"},dayClick:$scope.alertEventOnClick,eventDrop:$scope.alertOnDrop,eventResize:$scope.alertOnResize}},$scope.eventSources=[]}]),app.controller("DictionaryController",["$timeout","$scope","$animate",function($timeout,$scope,$animate){function parseSettings(){if(!localStorage.useUtilitronDict)return!0;switch(localStorage.useUtilitronDict){case"true":return!0;case"false":return!1}}function loadAll(){return{word:"definition"}}var self=this;self.words=loadAll(),$scope.useUtilitronDict=parseSettings(),$scope.$watch("useUtilitronDict",function(newVal,oldVal){localStorage.useUtilitronDict=newVal})}]),app.controller("GrammarController",["$scope",function($scope){}]),app.controller("NotesController",["$scope","$timeout","$animate",function($scope,$timeout,$animate){function saveToLocalStorage(){localStorage.notes=JSON.stringify($scope.notes)}function showToast(msg){msg=msg||""}$scope.notes=localStorage.notes?JSON.parse(localStorage.notes):[],$scope.save=function(note,noteIndex){console.log(noteIndex),noteIndex=noteIndex||null,noteIndex||0===noteIndex||$scope.notes.push(note),saveToLocalStorage(),showToast("Your note has been saved locally")},$scope.remove=function(index){$scope.notes.splice(index,1),saveToLocalStorage(),showToast("Note deleted")},$scope.open=function($event,note,noteIndex){}}]),app.controller("StopwatchController",["$scope","$timeout",function($scope,$timeout){function tick(){$scope.time++,$scope.timeout=$timeout(tick,1e3)}$scope.time=0,$scope.start=function(){tick()},$scope.stop=function(){$timeout.cancel($scope.timeout)},$scope.reset=function(){$scope.stop(),$scope.time=0,$scope.lappedTimes=[]},$scope.lappedTimes=[],$scope.lap=function(time){$scope.lappedTimes.push(time)}}]),app.controller("TelescopeCalculatorController",["$scope",function($scope){$scope.mag={},$scope.$watch("mag",function(){$scope.mag&&$scope.mag.tfl&&$scope.mag.efl?($scope.mag.magnification=$scope.mag.tfl/$scope.mag.efl,$scope.mag.magnificationDisplay=$scope.mag.magnification+"x"):null===$scope.mag.tfl&&null===$scope.mag.efl&&($scope.mag={})},!0),$scope.fr={},$scope.$watch("fr",function(){$scope.fr&&$scope.fr.tfl&&$scope.fr.aperture?($scope.fr.focalRatio=$scope.fr.tfl/$scope.fr.aperture,$scope.fr.focalRatioDisplay="f/"+$scope.fr.focalRatio):null===$scope.fr.tfl&&null===$scope.fr.aperture&&($scope.fr={})},!0),$scope.um={},$scope.$watch("um",function(){$scope.um&&$scope.um.aperture?($scope.um.usefulMag=2*$scope.um.aperture,$scope.um.usefulMagDisplay=$scope.um.usefulMag+"x"):null===$scope.um.aperture&&($scope.um={})},!0)}]),app.controller("TimeDifferenceController",["$scope",function($scope){function initTimes(){$scope.time.start=new Date(moment().set("seconds",0).set("milliseconds",0)),$scope.time.end=new Date(moment($scope.time.start).add(1,"hours"))}function calcTimeDiff(start,end){if(start&&end){var diff={};return start=moment(start),end=moment(end),diff.sec=end.diff(start,"seconds"),diff.min=end.diff(start,"minutes"),diff.hrs=end.diff(start,"hours",!0),diff.text=humanizeTimeDiff(diff.hrs,diff.min,diff.sec),diff}return null}function humanizeTimeDiff(hrs,min,sec){var h=Math.floor(hrs),m=min-60*hrs,s=sec-60*min;return h+(1===h?" hour, ":" hours, ")+m+(1===m?" minute, ":" minutes, ")+s+(1===s?" second":" seconds")}$scope.time={},$scope.$watch("time",function(newValue,oldValue){$scope.time.difference=calcTimeDiff($scope.time.start,$scope.time.end)},!0),initTimes()}]),app.controller("DateDifferenceController",["$scope",function($scope){function initDates(){$scope.date.start=new Date(moment().set("hours",0).set("minutes",0).set("seconds",0).set("milliseconds",0)),$scope.date.end=$scope.date.start}function calcDateDiff(start,end){if(start&&end){var diff={};return start=moment(start),end=moment(end),diff.years=end.diff(start,"years",!0),diff.months=end.diff(start,"months",!0),diff.days=end.diff(start,"days"),diff.text="a few seconds"===moment(end).from(moment(start),!0)?null:moment(end).from(moment(start),!0),diff}return null}$scope.date={},$scope.$watch("date",function(newValue,oldValue){$scope.date.diff=calcDateDiff(newValue.start,newValue.end)},!0),initDates()}]),app.controller("TimezoneController",["$scope",function($scope){}]),app.controller("UnitConversionController",["$timeout","$scope",function($timeout,$scope){function checkSameType(from,to){return from.unit&&to.unit&&from.unit.type==to.unit.type?(delete $scope.unitConversionForm.$error.incompat,!0):($scope.unitConversionForm.$error.incompat="Invalid: Unit types are incompatible",!1)}$scope.from={},$scope.to={},$scope.units=[{id:CONV_MASS,type:"mass",symbol:"kg",name:"Kilograms (kg)"},{id:CONV_MASS,type:"mass",symbol:"g",name:"Grams (g)"},{id:CONV_MASS,type:"mass",symbol:"oz",name:"Ounces (oz)"},{id:CONV_MASS,type:"mass",symbol:"lb",name:"Pounds (lb)"},{id:CONV_AREA,type:"area",symbol:"m2",name:"Square metre (m^2)"},{id:CONV_AREA,type:"area",symbol:"ft2",name:"Square foot (ft^2)"},{id:CONV_SPEED,type:"speed",symbol:"kmh",name:"Km per hour (km/h)"},{id:CONV_SPEED,type:"speed",symbol:"mph",name:"Miles per hour (mph)"},{id:CONV_LENGTH,type:"length",symbol:"m",name:"Metres (m)"},{id:CONV_LENGTH,type:"length",symbol:"cm",name:"Centimetres (cm)"},{id:CONV_LENGTH,type:"length",symbol:"yd",name:"Yards (yd)"},{id:CONV_LENGTH,type:"length",symbol:"ft",name:"Feet (ft)"},{id:CONV_LENGTH,type:"length",symbol:"in",name:"Inches (in)"},{id:CONV_LENGTH,type:"length",symbol:"mi",name:"Land miles (mi)"},{id:CONV_VOLUME,type:"volume",symbol:"l",name:"Litre (l)"},{id:CONV_VOLUME,type:"volume",symbol:"usgal",name:"US Gallons (gal)"},{id:CONV_VOLUME,type:"volume",symbol:"m3",name:"Cubic metres (m^3)"},{id:CONV_VOLUME,type:"volume",symbol:"ft3",name:"Cubic feet (ft^3)"}],$scope.types=_.uniq($scope.units,"type"),$scope.$watch("from",function(newVal,oldVal){newVal&&newVal.unit&&$scope.to.unit&&checkSameType(newVal,$scope.to)&&($scope.to.value=convert(newVal.unit.id,newVal.unit.symbol,$scope.to.unit.symbol,newVal.value))},!0),$scope.$watch("to",function(newVal,oldVal){newVal&&newVal.unit&&$scope.from.unit&&checkSameType($scope.from,newVal)&&(newVal.value=convert($scope.from.unit.id,$scope.from.unit.symbol,newVal.unit.symbol,$scope.from.value))},!0)}]),app.directive("menuLink",function(){return{scope:{section:"="},templateUrl:"app/partials/menu-link.tmpl.html",link:function($scope,$element){var controller=$element.parent().controller();$scope.isSelected=function(){return controller.isSelected($scope.section)},$scope.focusSection=function(){controller.autoFocusContent=!0}}}}),app.directive("menuToggle",function(){return{scope:{section:"="},templateUrl:"app/partials/menu-toggle.tmpl.html",link:function($scope,$element){var controller=$element.parent().controller();$scope.isOpen=function(){return controller.isOpen($scope.section)},$scope.toggle=function(){controller.toggleOpen($scope.section)}}}}),app.directive("utConstruction",function(){return{restrict:"E",transclude:!0,templateUrl:"app/partials/ut-construction.tmpl.html"}}),app.filter("nospace",function(){return function(value){return value?value.replace(/ /g,""):""}}),app.filter("humanizeDoc",function(){return function(doc){return doc?"directive"===doc.type?doc.name.replace(/([A-Z])/g,function($1){return"-"+$1.toLowerCase()}):doc.label||doc.name:void 0}}),app.filter("ucfirst",function(){return function(value){return value?value.charAt(0).toUpperCase()+value.substr(1):""}}),app.filter("ucwords",function(){return function(value){return value?value.replace(/\b([a-z])/g,function(all,first){return first.toUpperCase()}):void 0}}),app.factory("menu",["$location","$rootScope",function($location,$rootScope){var self,sections=[{name:"Time/Date",type:"toggle",pages:[{name:"Time Difference",url:"#/timedate/timedifference",type:"link",icon:"fa fa-fw fa-clock-o"},{name:"Date Difference",url:"#/timedate/datedifference",type:"link",icon:"fa fa-fw fa-calendar-o"},{name:"Timezone Finder",url:"#/timedate/timezone",type:"link",icon:"fa fa-fw fa-globe"},{name:"Calendar",url:"#/timedate/calendar",type:"link",icon:"fa fa-fw fa-calendar"},{name:"Stopwatch",url:"#/timedate/stopwatch",type:"link",icon:"mdi-hardware-watch"}]},{name:"Unit Conversion",url:"#/unitconversion",type:"link"},{name:"Calculator",url:"#/calculator",type:"link"},{name:"Language",type:"toggle",pages:[{name:"Dictionary",url:"#/language/dictionary",type:"link",icon:"fa fa-fw fa-book"},{name:"Grammar Reference",url:"#/language/grammar",type:"link",icon:"fa fa-fw fa-info-circle"}]},{name:"Astronomy",type:"toggle",pages:[{name:"Telescope Calculator",url:"#/astronomy/telescopecalculator",type:"link",icon:"fa fa-fw fa-star"}]},{name:"Document",type:"toggle",pages:[{name:"Notes",url:"#/document/notes",type:"link",icon:"fa fa-fw fa-pencil-square-o"},{name:"To Do",url:"#/document/todo",type:"link",icon:"fa fa-fw fa-tasks"}]}];return self={sections:sections,selectSection:function(section){self.openedSection=section},toggleSelectSection:function(section){self.openedSection=self.openedSection===section?null:section},isSectionSelected:function(section){return self.openedSection===section},selectPage:function(section,page){self.currentSection=section,self.currentPage=page},isPageSelected:function(page){return self.currentPage===page}}}]);